branches: 
  only: 
    - travis
language: c

sudo: required
dist: trusty

notifications: 
  email: false

  
git:
    submodules: false

services: 
  - docker

matrix:
  include:
   #  - os: osx
   #   script:
  
    - os: linux
      before_install: 
        - sudo apt-get update
        - sudo service docker restart
        - sleep 5
        - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
        - sudo docker pull onnc/ubuntu-14.04-llvm &
        - while wait "$PID"; do echo "test"; sleep 2; done
        - sudo docker create --privileged=true -t --name container  onnc/ubuntu-14.04-llvm
        - sudo docker start container


      script: 
        - sudo docker exec -t container /bin/bash -c "git clone https://github.com/ONNC/umbrella.git"
        - sudo docker exec -t container /bin/bash -c "cd umbrella && git submodule init"
        - sudo docker exec -t container /bin/bash -c "cd umbrella && git submodule update"
        - sudo docker exec -t container /bin/bash -c "mkdir ./umbrella/onnc-build"
        #- sudo docker exec -t container /bin/bash -c "./umbrella/build.sh dbg ./umbrella/onnc-build"
        - sudo docker exec -t container /bin/bash -c "cd umbrella && ./build.cmake.sh dbg ./onnc-build"